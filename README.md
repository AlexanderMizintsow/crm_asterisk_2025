# CRM Asterisk 2025

Система управления звонками с интеграцией Asterisk PBX для CRM.

## Описание

CRM система для обработки входящих звонков с автоматическим уведомлением пользователей, управлением статусами звонков и изоляцией пользователей по номерам телефонов.

## Технологии

- **Frontend**: React.js, Vite
- **Backend**: Node.js, Socket.IO
- **База данных**: PostgreSQL
- **Интеграция**: Asterisk AMI (Manager Interface)

## Функциональность

### Основной flow звонков:
1. **Входящий звонок** → сервер получает событие от Asterisk
2. **Уведомление** → пользователь получает модальное окно с информацией о звонке
3. **Поднятие трубки** → автоматический переход к активному звонку
4. **Завершение** → показ кнопки "Завершить" для ручного закрытия

### Изоляция пользователей:
- Пользователь получает уведомления только о звонках на свой номер
- Звонок на номер 777 получает только Иван (ID: 14)
- Звонок на номер 888 получает только Петр (ID: 15)

## Установка и запуск

### Предварительные требования:
- Node.js
- PostgreSQL
- Asterisk PBX (опционально для тестирования)

### Установка зависимостей:
```bash
npm install
```

### Настройка базы данных:
```bash
node server/setup-database.js
```

### Запуск серверов:
```bash
npm run servers
```

### Запуск фронтенда:
```bash
npm run dev
```

## Тестирование

### Тест полного flow звонка:
```bash
node server/testCall.js
```

### Тест изоляции пользователей:
```bash
node test-isolation.js
```

## Структура проекта

```
├── src/                    # React фронтенд
│   ├── components/         # React компоненты
│   │   └── crm_asterisk/   # CRM компоненты
│   └── App.jsx            # Главный компонент
├── server/                # Node.js бэкенд
│   ├── websocket-server.js # WebSocket сервер
│   ├── asterisk-server.js  # Asterisk интеграция
│   └── testCall.js        # Тест звонков
└── database/              # SQL скрипты
```

## Конфигурация

### Пользователи по умолчанию:
- **Иван Иванов** (ID: 14) → номер **777**
- **Петр Петров** (ID: 15) → номер **888**

### Порт сервера:
- WebSocket сервер: 3771
- Asterisk AMI: 5038

## Лицензия

MIT
